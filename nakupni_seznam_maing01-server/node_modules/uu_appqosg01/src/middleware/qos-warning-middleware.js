"use strict";
const MIDDLEWARE_ORDER = 105;

class QosWarningMiddleware {
  constructor() {
    this.name = "Warning Handler";
    this.order = MIDDLEWARE_ORDER;
  }

  post(req, res, next) {
    let response = res.locals.response;
    const warningList = res.locals.uuAppQOSWarningList;
    if (warningList && response.body && typeof response.body === "object" && typeof response.body.pipe !== "function") {
      response.body.uuAppErrorMap = { ...response.body.uuAppErrorMap, ...warningList };
    }
    return next();
  }
}

module.exports = QosWarningMiddleware;
